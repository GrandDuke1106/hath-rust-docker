# Hath-Rust-Docker

[Dockeré•œåƒ](https://hub.docker.com/r/grandduke1106/hath-rust-docker)
[](https://hub.docker.com/r/grandduke1106/hath-rust-docker/tags)

è¿™æ˜¯ä¸€ä¸ªä¸º [hath-rust](https://github.com/james58899/hath-rust) åº”ç”¨æ‰“é€ çš„ï¼Œå®‰å…¨ã€è½»é‡ã€è·¨å¹³å°çš„é«˜è´¨é‡ Docker é•œåƒã€‚

æœ¬é•œåƒåŸºäº Google çš„ `distroless/static` åŸºç¡€é•œåƒæ„å»ºï¼Œç¡®ä¿äº†æå°çš„ä½“ç§¯ã€‚é•œåƒå†…çš„åº”ç”¨é»˜è®¤ä»¥é root ç”¨æˆ·è¿è¡Œï¼Œè¿›ä¸€æ­¥å¢å¼ºäº†å®‰å…¨æ€§ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

**å¯é€‰**: æ–°å»ºç”¨æˆ·ï¼Œé¿å…ä½¿ç”¨è¯¸å¦‚rootç­‰é«˜æƒé™ç”¨æˆ·ã€‚
```bash
sudo useradd -m -d /home/username -s /bin/bash username
su - username
```
å…¶ä¸­ï¼š `-m`ï¼šåˆ›å»ºç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ `-d`ï¼šæŒ‡å®šç”¨æˆ·çš„ä¸»ç›®å½•è·¯å¾„ã€‚ `-s`ï¼šæŒ‡å®šç”¨æˆ·çš„ shellï¼›å¹¶ä¸”ä½¿ç”¨`su`å‘½ä»¤åˆ‡æ¢ç”¨æˆ·ã€‚

**ç¬¬ä¸€æ­¥**: åœ¨ä½ çš„ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºå­˜å‚¨ `hath-rust` çš„æ•°æ®ã€é…ç½®æˆ–æ—¥å¿—ã€‚

```bash
mkdir -p ./hath
```

**ç¬¬äºŒæ­¥**: è¿è¡Œ Docker å®¹å™¨ï¼Œå¹¶å°†ä¸»æœºç›®å½•æŒ‚è½½è¿›å»ã€‚

```bash
docker run --rm -it \
  -p 8080:8080 \
  --user "$(id -u):$(id -g)" \
  -v ./hath:/hath \
  grandduke1106/hath-rust-docker:latest \
  <ä½ çš„hath-rustç¨‹åºå‚æ•°>
```

### å‘½ä»¤è¯¦è§£

  * `--rm`: å®¹å™¨åœæ­¢åè‡ªåŠ¨åˆ é™¤ï¼Œé€‚åˆä¸´æ—¶è¿è¡Œå’Œæµ‹è¯•ã€‚
  * `-it`: å¼€å¯äº¤äº’æ¨¡å¼å¹¶åˆ†é…ä¸€ä¸ªç»ˆç«¯ï¼Œåœ¨æˆåŠŸè¾“å…¥idå’Œå¯†ç åå³å¯å»é™¤è¿™ä¸ªå‚æ•°ã€‚
  * `-p 8080:8080`: å°†ä½ ä¸»æœºçš„ `8080` ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ `8080` ç«¯å£ã€‚**è¯·æ ¹æ® `hath-rust` å®é™…ä½¿ç”¨çš„ç«¯å£è¿›è¡Œä¿®æ”¹**ã€‚
  * `--user "$(id -u):$(id -g)"`: è®©å®¹å™¨å†…çš„è¿›ç¨‹ä»¥ä½ å½“å‰ä¸»æœºçš„ç”¨æˆ·èº«ä»½è¿è¡Œï¼Œä»è€Œè§£å†³æŒ‚è½½ç›®å½•æ—¶çš„æƒé™é—®é¢˜ã€‚
  * `-v ./hath:/hath`: å°†å½“å‰è·¯å¾„ä¸‹çš„ `hath` ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ `/hath` å·¥ä½œç›®å½•ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨æ•°æ®ã€‚
  * `grandduke1106/hath-rust-docker:latest`: æŒ‡å®šè¦è¿è¡Œçš„é•œåƒã€‚
  * `<ä½ çš„hath-rustç¨‹åºå‚æ•°>`: åœ¨è¿™é‡Œè¿½åŠ ä¼ é€’ç»™ `hath-rust` ç¨‹åºçš„æ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚

-----

## âš™ï¸ è¯¦ç»†é…ç½®

### æŒä¹…åŒ–ä¸æƒé™

ä¸ºäº†è®© `hath-rust` çš„æ•°æ®ï¼ˆä¾‹å¦‚é…ç½®æ–‡ä»¶ã€æ—¥å¿—ã€æ•°æ®åº“ç­‰ï¼‰åœ¨å®¹å™¨é‡å¯åä¾ç„¶å­˜åœ¨ï¼Œä½ éœ€è¦å°†ä¸€ä¸ªä¸»æœºç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ `/hath` å·¥ä½œç›®å½•ä¸­ã€‚

ç”±äºå®¹å™¨å†…çš„è¿›ç¨‹é»˜è®¤ä»¥é root ç”¨æˆ·è¿è¡Œï¼Œç›´æ¥æŒ‚è½½ä¸»æœºçš„æ™®é€šç›®å½•ä¼šå¯¼è‡´æƒé™å†²çª (`Permission Denied` é”™è¯¯)ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼ºçƒˆæ¨èåœ¨ `docker run` å‘½ä»¤ä¸­æ·»åŠ  `--user "$(id -u):$(id -g)"` å‚æ•°ã€‚

è¿™ä¼šä½¿å®¹å™¨å†…è¿›ç¨‹çš„ UID å’Œ GID ä¸ä½ ä¸»æœºå½“å‰ç”¨æˆ·çš„ UID å’Œ GID ä¿æŒä¸€è‡´ï¼Œä»è€Œç¡®ä¿å¯¹æŒ‚è½½ç›®å½•æ‹¥æœ‰æ­£å¸¸çš„è¯»å†™æƒé™ã€‚

### å‘ `hath-rust` ä¼ é€’å‚æ•°

æœ¬é•œåƒçš„ `ENTRYPOINT` è¢«è®¾ç½®ä¸º `hath-rust` ç¨‹åºã€‚å› æ­¤ï¼Œä½ åœ¨ `docker run` å‘½ä»¤ä¸­ï¼Œé•œåƒåä¹‹åæä¾›çš„ä»»ä½•å†…å®¹éƒ½å°†ç›´æ¥ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ä¼ é€’ç»™ `hath-rust` ç¨‹åºã€‚

**ç¤ºä¾‹:**

  * **æŸ¥çœ‹ç¨‹åºå¸®åŠ©ä¿¡æ¯:**

    ```bash
    docker run --rm grandduke1106/hath-rust-docker --help
    ```

  * **æŒ‡å®šç«¯å£:**
    

    ```bash
    docker run --it -p 8080:8080 -v ./hath:/hath --user "$(id -u):$(id -g)" grandduke1106/hath-rust-docker --port 8080
    ```

### ä½¿ç”¨ Docker å‘½åå· (æ›¿ä»£æ–¹æ¡ˆ)

å¦‚æœä½ ä¸å¸Œæœ›å°†æ•°æ®å­˜å‚¨åœ¨ä¸»æœºçš„ç‰¹å®šè·¯å¾„ä¸‹ï¼Œè€Œæ˜¯è®© Docker æ¥ç®¡ç†ï¼Œå¯ä»¥ä½¿ç”¨å‘½åå·ã€‚

1.  **åˆ›å»ºä¸€ä¸ªå‘½åå·:**

    ```bash
    docker volume create hath-app-data
    ```

2.  **ä½¿ç”¨å‘½åå·å¯åŠ¨å®¹å™¨:**

    ```bash
    docker run --rm -it \
      -p 8080:8080 \
      -v hath-app-data:/hath \
      grandduke1106/hath-rust-docker:latest
    ```

    ä½¿ç”¨å‘½åå·æ—¶ï¼ŒDocker ä¼šè‡ªåŠ¨å¤„ç†æƒé™é—®é¢˜ï¼Œå› æ­¤é€šå¸¸ä¸å†éœ€è¦ `--user` å‚æ•°ã€‚

## ğŸ·ï¸ é•œåƒæ ‡ç­¾

  * `latest`: æŒ‡å‘æœ€æ–°å‘å¸ƒçš„ç¨³å®šç‰ˆæœ¬ã€‚
  * `vX.Y.Z` (ä¾‹å¦‚ `v1.12.1`): æŒ‡å‘ç‰¹å®šçš„å‘è¡Œç‰ˆæœ¬ï¼Œæ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä»¥ç¡®ä¿å¯å¤ç°æ€§ã€‚
